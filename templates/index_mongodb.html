{% extends "base.html" %}

{% block title %}Dashboard - Quiz Platform{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Quiz Modules Dashboard</h1>
    <p>Manage your quiz modules and questions</p>
    <div class="header-actions">
        <a href="{{ url_for('all_questions') }}" class="btn btn-info">View All Questions</a>
    </div>
</div>

<div class="section">
    <h2>Create New Module</h2>
    <form method="POST" action="{{ url_for('add_module') }}" class="module-form">
        <div class="form-group">
            <input type="text" name="module_name" placeholder="Enter module name (e.g., Level-4-1, Team Module)" required class="form-input">
            <button type="submit" class="btn btn-primary">Create Module</button>
        </div>
    </form>
</div>

<div class="section">
    <h2>Existing Modules</h2>
    {% if modules %}
        <div class="modules-grid">
            {% for module in modules %}
            <div class="module-card">
                <div class="module-header">
                    <h3>{{ module.name }}</h3>
                    <small class="module-date">Created: {{ module.created_at }}</small>
                </div>
                <div class="module-actions">
                    <a href="{{ url_for('module_view', module_id=module._id) }}" class="btn btn-secondary">View Questions</a>
                    <a href="{{ url_for('add_question', module_id=module._id) }}" class="btn btn-success">Add Question</a>
                    <a href="{{ url_for('answers_view', module_id=module._id) }}" class="btn btn-info">View Answers</a>
                    <a href="{{ url_for('delete_module', module_id=module._id) }}" 
                       class="btn btn-danger" 
                       onclick="return confirmDoubleDelete('module', '{{ module.name }}')">Delete</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <p>No modules created yet. Create your first module above!</p>
        </div>
    {% endif %}
</div>

{% if all_questions %}
<div class="section">
    <h2>All Questions</h2>
    <p>Recently added questions from all modules</p>
    <div class="questions-grid">
        {% for question in all_questions[:12] %}
        <div class="question-card">
            <div class="question-image">
                <img src="{{ url_for('uploaded_file', filename=question.image_path) }}" 
                     alt="{{ question.name or 'Question ' ~ loop.index }}" 
                     class="question-img">
            </div>
            <div class="question-info">
                <p class="question-number">{{ question.name or 'Question #' ~ loop.index }}</p>
                <small class="question-module">Module: {{ question.module_info.name }}</small>
                <small class="question-date">Added: {{ question.created_at }}</small>
            </div>
            <div class="question-actions">
                <a href="{{ url_for('question_answer', question_id=question._id) }}" 
                   class="btn btn-info btn-small">View Answer</a>
                <a href="{{ url_for('delete_question', question_id=question._id) }}" 
                   class="btn btn-danger btn-small delete-question" 
                   data-name="{{ question.name or 'this question' }}">Delete</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% if all_questions|length > 12 %}
    <div class="view-more">
        <p>Showing latest 12 questions. Visit individual modules to see all questions.</p>
    </div>
    {% endif %}
</div>
{% endif %}

<script>
function confirmDoubleDelete(type, name) {
    if (confirm(`Are you sure you want to delete this ${type} "${name}"? This action cannot be undone.`)) {
        return confirm(`This is your final confirmation. Are you absolutely sure you want to delete this ${type}? All data will be permanently lost.`);
    }
    return false;
}

// Handle delete question clicks
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delete-question').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const name = this.getAttribute('data-name');
            if (confirmDoubleDelete('question', name)) {
                window.location.href = this.href;
            }
        });
    });
});
</script>

<style>
.view-more {
    text-align: center;
    margin-top: 1.5rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    color: #64748b;
}

.question-module {
    display: block;
    color: #7c3aed;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.header-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .header-actions {
        justify-content: center;
    }
}
</style>
{% endblock %}